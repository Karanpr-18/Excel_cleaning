<!DOCTYPE html>
<html lang="en">
<head>    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Humana NGO | Excel Data Cleaner - Upload</title>
    
    <link href="{{ url_for('static', filename='css/upload.css') }}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon.jpeg') }}">
</head>
<body>
    <div class="header">
        <div class="menu-icon" onclick="toggleMenu()">â˜°</div>
        <div class="drawer-wrapper">
            <div class="side-menu" id="sideMenu">         
                <div class="accordion">
                    <div class="accordion-header" onclick="toggleDropdown(this)">
                        <a href="https://humana-india.org/"><span>HOME</span></a>
                    </div>
                </div>
                
                <div class="accordion">
                    <div class="accordion-header">
                        <a href="https://humana-india.org/"><span>ABOUT US</span></a>
                        <div class="right-controls">
                            <span class="plus" onclick="toggleDropdown(this)">+</span>
                        </div>
                    </div>
                    <div class="accordion-content">
                        <a href="https://humana-india.org/about-us/">Who We Are</a>
                        <a href="https://humana-india.org/our-partners/">Our Partners</a>
                    </div>
                </div>
                
                <div class="accordion">
                    <div class="accordion-header" onclick="toggleDropdown(this)">
                        <a href="#"><span>PROGRAMMES & IMPACT</span></a>
                        <span class="plus">+</span>
                    </div>
                    <div class="accordion-content">
                        <a href="https://humana-india.org/education/">Education</a>
                        <a href="https://humana-india.org/community-development/">Livelihood and Community Development</a>
                        <a href="https://humana-india.org/health/">Health</a>
                        <a href="https://humana-india.org/environmental-sustainability/">Environmental Sustainability</a>
                    </div>
                </div>
                
                <div class="accordion">
                    <div class="accordion-header" onclick="toggleDropdown(this)">
                        <a href="#"><span>REPORTS & PUBLICATIONS</span></a>
                        <span class="plus">+</span>
                    </div>
                    <div class="accordion-content">
                        <a href="https://humana-india.org/annual-report/">Annual Reports</a>
                        <a href="https://humana-india.org/publications/">Publications</a>
                        <a href="https://humana-india.org/stories-from-the-field/">Stories from the Field</a>
                        <a href="https://humana-india.org/audited-financial-reports/">Audited Financial Reports</a>
                        <a href="https://humana-india.org/foreign-contribution-reports/">Foreign Contribution Reports</a>
                        <a href="https://humana-india.org/awards-and-recognition/">Awards and Recognition</a>
                        <a href="https://humana-india.org/videos/">Videos</a>
                    </div>
                </div>
                
                <div class="accordion">
                    <div class="accordion-header" onclick="toggleDropdown(this)">
                        <a href="#"><span>GET INVOLVED</span></a>
                        <span class="plus">+</span>
                    </div>
                    <div class="accordion-content">
                        <a href="https://humana-india.org/career/">Work with Us</a>
                        <a href="https://humana-india.org/partner-with-us/">Partner with Us</a>
                        <a href="https://humana-india.org/contact-us/">Contact Us</a>
                    </div>
                </div>
                
                <div class="accordion">
                    <div class="accordion-header" onclick="toggleDropdown(this)">
                        <a href="https://humana-india.org/blog/"><span>BLOGS</span></a>
                    </div>
                </div>
                
                <div class="social-icons">
                    <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                    <a href="#"><i class="fa-brands fa-twitter"></i></a>
                    <a href="#"><i class="fa-brands fa-youtube"></i></a>
                    <a href="#"><i class="fa-brands fa-linkedin-in"></i></a>
                </div>
                
                <a href="https://humana-india.org/donate/">
                    <button class="donate-button">Donate</button>
                </a>
            </div>
            <button class="drawer-wrapper-btn" id="drawerWrapperBtn" onclick="toggleMenu()">
                <i class="fa-regular fa-circle-xmark"></i>
            </button>
        </div>
        
        <div class="header-inner">
            <div class="logo-container">
                <a href="https://humana-india.org/">
                    <img src="{{ url_for('static', filename='images/Humana-logo-new.jpg') }}" alt="Humana Logo">
                </a>
            </div>
            <nav class="header-nav">
                <div class="nav-item">
                    <a href="https://humana-india.org/">Home</a>
                </div>
                <div class="about-us nav-item">
                    <a href="https://humana-india.org/about-us/">About Us
                        <svg width="7" height="8" viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1L6 6L11 1" stroke="#404040" stroke-width="2" fill="none" stroke-linecap="round"/>
                        </svg>
                    </a>
                    <div class="dropdown about">
                        <a href="https://humana-india.org/about-us/">Who We Are</a>
                        <a href="https://humana-india.org/our-partners/" class="bottom-link">Our Partners</a>
                    </div>
                </div>
                <div class="programmes nav-item">
                    <a href="#">Programmes & Impact
                        <svg width="7" height="8" viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1L6 6L11 1" stroke="#404040" stroke-width="2" fill="none" stroke-linecap="round"/>
                        </svg>
                    </a>
                    <div class="dropdown programmes">
                        <a href="https://humana-india.org/education/">Education</a>
                        <a href="https://humana-india.org/community-development/">Livelihood and Community Development</a>
                        <a href="https://humana-india.org/health/">Health</a>
                        <a href="https://humana-india.org/environmental-sustainability/" class="bottom-link">Environmental Sustainability</a>
                    </div>
                </div>
                <div class="reports nav-item">
                    <a href="#">Reports & Publications
                        <svg width="7" height="8" viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1L6 6L11 1" stroke="#404040" stroke-width="2" fill="none" stroke-linecap="round"/>
                        </svg>
                    </a>
                    <div class="dropdown reports">
                        <a href="https://humana-india.org/annual-report/">Annual Reports</a>
                        <a href="https://humana-india.org/publications/">Publications</a>
                        <a href="https://humana-india.org/stories-from-the-field/">Stories from the Field</a>
                        <a href="https://humana-india.org/audited-financial-reports/">Audited Financial Reports</a>
                        <a href="https://humana-india.org/foreign-contribution-reports/">Foreign Contribution Reports</a>
                        <a href="https://humana-india.org/awards-and-recognition/">Awards and Recognition</a>
                        <a href="https://humana-india.org/videos/" class="bottom-link">Videos</a>
                    </div>
                </div>
                <div class="involved nav-item">
                    <a href="#">Get Involved
                        <svg width="7" height="8" viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1 1L6 6L11 1" stroke="#404040" stroke-width="2" fill="none" stroke-linecap="round"/>
                        </svg>
                    </a>
                    <div class="dropdown involved">
                        <a href="https://humana-india.org/career/">Work with Us</a>
                        <a href="https://humana-india.org/partner-with-us/">Partner with Us</a>
                        <a href="https://humana-india.org/contact-us/" class="bottom-link">Contact Us</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="https://humana-india.org/blog/">Blogs</a>
                </div>
                <div class="nav-item">
                    <a href="{{ url_for('logout') }}" class="logout-link">Logout</a>
                </div>
                <a href="https://humana-india.org/donate/">
                    <button class="donate-button">Donate</button>
                </a>
            </nav>
        </div>
    </div>

    <div class="upload-wrapper">
        <div class="upload-card">
            <h2>Upload Excel File</h2>
            <p class="tagline">Drag and drop your Excel file below or click to select it.</p>
    
            <!-- Flash messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="{{ 'error-message' if category == 'error' else 'success-message' if category == 'success' else 'info-message' }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            <form method="POST" enctype="multipart/form-data" id="upload-form">
                <!-- Validation Method Selector -->
                <div class="validation-method-selector">
                    <label for="validation_method">Choose Validation Method:</label>
                    <select id="validation_method" name="validation_method" class="method-dropdown">
                        <option value="kadam">Kadam </option>
                        <option value="kadam_plus">Kadam+ </option>
                    </select>
                </div>
                
                <div class="drop-zone" id="drop-zone">
                    <input type="file" id="fileInput" name="file" accept=".xlsx,.xls" />
                    <p>Drop your Excel file here or <span class="browse-btn">browse</span></p>
                </div>
            </form>
    
            <div class="file-name" id="file-name">No file selected</div>
            
            <div class="progress-container" id="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="progress-text" id="progress-text">Processing file...</div>
            
            <button class="action-button" id="clean-button" onclick="submitForm()" disabled>Clean File</button>
            
            {% if session.processed_files %}
                <div class="file-controls">
                    <a href="{{ url_for('download_file', file_type='output') }}" class="download-button" style="text-decoration: none; display: inline-block; width: 48%; margin-right: 2%;">
                        Download Cleaned File
                    </a>
                    <a href="{{ url_for('download_file', file_type='report') }}" class="download-button" style="text-decoration: none; display: inline-block; width: 48%;">
                        Download Report
                    </a>
                </div>
                <a href="{{ url_for('clear_files') }}" style="color: #ff5b33; text-decoration: none; font-size: 14px;">
                    Clear Files
                </a>
            {% endif %}
        </div>
    </div>

    <script>
        const dropZone = document.getElementById("drop-zone");
        const fileInput = document.getElementById("fileInput");
        const fileNameDisplay = document.getElementById("file-name");
        const cleanButton = document.getElementById("clean-button");

        // Click to browse
        dropZone.addEventListener("click", () => fileInput.click());
        
        // Drag and drop functionality
        dropZone.addEventListener("dragover", (e) => {
            e.preventDefault();
            dropZone.classList.add("dragover");
        });
        
        dropZone.addEventListener("dragleave", () => {
            dropZone.classList.remove("dragover");
        });
        
        dropZone.addEventListener("drop", (e) => {
            e.preventDefault();
            dropZone.classList.remove("dragover");
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect();
            }
        });
        
        // File input change
        fileInput.addEventListener("change", handleFileSelect);
        
        function handleFileSelect() {
            const file = fileInput.files[0];
            if (file) {
                fileNameDisplay.textContent = `Selected: ${file.name}`;
                cleanButton.disabled = false;
                cleanButton.style.backgroundColor = "#ff5b33";
            } else {
                fileNameDisplay.textContent = "No file selected";
                cleanButton.disabled = true;
                cleanButton.style.backgroundColor = "#ccc";
            }
        }
        
        function submitForm() {
            if (fileInput.files.length > 0) {
                // Show processing state
                cleanButton.textContent = "Processing...";
                cleanButton.disabled = true;
                
                // Show progress bar
                document.getElementById("progress-container").style.display = "block";
                document.getElementById("progress-text").style.display = "block";
                
                // Animate progress bar
                startProgressAnimation();
                
                // Submit the form
                document.getElementById("upload-form").submit();
            }
        }
        
        function startProgressAnimation() {
            const progressBar = document.getElementById("progress-bar");
            const progressText = document.getElementById("progress-text");
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 15 + 5; // Random increment between 5-20%
                
                if (progress >= 95) {
                    progress = 95; // Stop at 95% until actual completion
                    clearInterval(interval);
                    progressText.textContent = "Finalizing validation...";
                }
                
                progressBar.style.width = progress + "%";
                
                if (progress < 30) {
                    progressText.textContent = "Reading Excel file...";
                } else if (progress < 60) {
                    progressText.textContent = "Validating data...";
                } else if (progress < 90) {
                    progressText.textContent = "Generating reports...";
                }
            }, 200);
        }

        function toggleMenu() {
            const drawerWrapper = document.querySelector('.drawer-wrapper');
            drawerWrapper.classList.toggle('show');
        }

        function toggleDropdown(element) {
            const content = element.parentElement.querySelector('.accordion-content');
            const plus = element.querySelector('.plus');
            
            if (content) {
                if (content.style.display === 'flex') {
                    content.style.display = 'none';
                    if (plus) plus.textContent = '+';
                } else {
                    content.style.display = 'flex';
                    if (plus) plus.textContent = '-';
                }
            }
        }
    </script>
</body>
</html>
